{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
</head>
<body>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let statesDistricts = {}; // We will load this from the JSON file
            fetch('/static/states_districts.json') // Adjust the path as necessary
                .then(response => response.json())
                .then(data => {
                    statesDistricts = data.states;
                    populateStates();
                });

            function populateStates() {
                const stateSelect = document.getElementById('state');
                statesDistricts.forEach(state => {
                    const option = document.createElement('option');
                    option.value = state.state;
                    option.text = state.state;
                    stateSelect.add(option);
                });
                populateDistricts(stateSelect.value);
            }

            document.getElementById('state').addEventListener('change', function () {
                const selectedState = this.value;
                populateDistricts(selectedState);
            });

            function populateDistricts(selectedState) {
                const districtSelect = document.getElementById('district');
                districtSelect.innerHTML = '<option value="">Select District</option>'; // Reset districts
                const stateObj = statesDistricts.find(state => state.state === selectedState);
                if (stateObj) {
                    stateObj.districts.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district.name;
                        option.text = district.name;
                        districtSelect.add(option);
                    });
                    populateColleges(selectedState, districtSelect.value); // Populate colleges for default district
                }
            }

            document.getElementById('district').addEventListener('change', function () {
                const selectedState = document.getElementById('state').value;
                const selectedDistrict = this.value;
                populateColleges(selectedState, selectedDistrict);
            });

            function populateColleges(selectedState, selectedDistrict) {
                const collegeSelect = document.getElementById('college');
                collegeSelect.innerHTML = '<option value="">Select College</option>'; // Reset colleges
                const stateObj = statesDistricts.find(state => state.state === selectedState);
                if (stateObj) {
                    const districtObj = stateObj.districts.find(district => district.name === selectedDistrict);
                    if (districtObj && districtObj.colleges) {
                        districtObj.colleges.forEach(college => {
                            const option = document.createElement('option');
                            option.value = college;
                            option.text = college;
                            collegeSelect.add(option);
                        });
                    }
                }
                const otherOption = document.createElement('option');
                otherOption.value = 'other';
                otherOption.text = 'Other (Enter New College)';
                collegeSelect.add(otherOption);
            }

            document.getElementById('college').addEventListener('change', function () {
                const newCollegeInput = document.getElementById('new-college');
                if (this.value === 'other') {
                    newCollegeInput.style.display = 'block';
                } else {
                    newCollegeInput.style.display = 'none';
                }
            });
        });
    </script>

    <form action="{% url 'updateprofile' id=id %}" method="post">
        {% csrf_token %}
        <div class="row display-flex">
            <div class="col-lg-2 col-sm-12 l">
                <label for="">Username:</label>
            </div>
            <div class="col-lg-10 col-sm-12 i">
                <input type="text" name="name" required>
            </div>
        </div>
        <input type="hidden" name="email" value="{{email}}">
        <input type="hidden" name="myid" id="" value="{{id}}">

        <div class="row ">
            <div class="col-lg-2 col-sm-12 l">
                <label for="">Year of Study:</label>
            </div>
            <div class="col-lg-10 col-sm-12 i">
                <input type="number" name="year" pattern="[1-9]{1}" required>
            </div>
        </div>

        <div class="row">
            <div class="label">
                <label id="state-label" for="state">State</label>
            </div>
            <div class="rightinput">
                <select class="input-field" id="state" name="state" required>
                    <option value="">Select State</option>
                </select>
            </div>
        </div>

        <div class="row">
            <div class="label">
                <label id="district-label" for="district">District</label>
            </div>
            <div class="rightinput">
                <select class="input-field" id="district" name="district" required>
                    <option value="">Select District</option>
                </select>
            </div>
        </div>

        <div class="row">
            <div class="label">
                <label id="college-label" for="college">College</label>
            </div>
            <div class="rightinput">
                <select class="input-field" id="college" name="college" required>
                    <option value="">Select College</option>
                    <option value="other">Other (Enter New College)</option>
                </select>
                <input class="input-field" id="new-college" type="text" name="new_college" placeholder="Enter New College" style="display:none;">
            </div>
        </div>

        <div class="row ">
            <div class="col-lg-2 col-sm-12 l">
                <label for="">Mobile:</label>
            </div>
            <div class="col-lg-10 col-sm-12 i">
                <input type="tel" name="phone" pattern="[123456789][0-9]{9}" required>
            </div>
        </div>
        <div class="row ">
            <div class="col-lg-2 col-sm-12 l">
                <label for="">Whatsapp Number:</label>
            </div>
            <div class="col-lg-10 col-sm-12 i">
                <input type="tel" name="whatsapp" pattern="[123456789][0-9]{9}" required>
            </div>
        </div>

        <div class="row ">
            <div class="col-lg-10 col-sm-12 i">
                <input type="text" name="bonus" placeholder="Referral Code">
            </div>
        </div>

        <div class="row display-flex justify-content-center">
            <div class="s" style="display: flex;justify-content:center;">
                <button class="btn btn-outline-success b" type="submit">Submit</button>
            </div>
        </div>
    </form>
</body>
</html>
